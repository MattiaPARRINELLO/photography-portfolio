<!DOCTYPE html>
<html lang="fr" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Éditeur de Textes - Portfolio</title>
    <link rel="icon" type="image/svg+xml" href="/dist/assets/Logo_MP.svg">
    <link rel="stylesheet" href="/dist/output.css">
    <!-- Alpine.js -->
    <script
      defer
      src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"
    ></script>
    <!-- Start - Fonts -->
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link
      href="https://fonts.googleapis.com/css2?family=Signika:wght@400;700&display=swap"
      rel="stylesheet"
    />
    <!-- End - Fonts -->
    <style>
        * {
            font-family: 'Signika', sans-serif;
        }
        
        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: linear-gradient(135deg, 
                #000000 0%, 
                #1a1a2e 25%, 
                #16213e 50%, 
                #0f3460 75%, 
                #000000 100%);
            position: relative;
            overflow: hidden;
        }
        
        .login-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(circle at 20% 30%, rgba(102, 126, 234, 0.4), transparent 40%),
                        radial-gradient(circle at 80% 20%, rgba(139, 69, 19, 0.3), transparent 50%),
                        radial-gradient(circle at 40% 80%, rgba(75, 0, 130, 0.35), transparent 60%),
                        radial-gradient(circle at 90% 90%, rgba(255, 20, 147, 0.2), transparent 45%);
            animation: gradientShift 12s ease-in-out infinite alternate;
        }
        
        .login-container::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.02'%3E%3Ccircle cx='30' cy='30' r='2'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E") repeat;
            opacity: 0.3;
        }
        
        @keyframes gradientShift {
            0% { 
                filter: hue-rotate(0deg) brightness(1); 
                transform: scale(1);
            }
            33% { 
                filter: hue-rotate(60deg) brightness(1.2); 
                transform: scale(1.05);
            }
            66% { 
                filter: hue-rotate(-30deg) brightness(0.9); 
                transform: scale(0.98);
            }
            100% { 
                filter: hue-rotate(30deg) brightness(1.1); 
                transform: scale(1.02);
            }
        }
        
        .login-card {
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(25px);
            border-radius: 24px;
            padding: 3rem 2.5rem;
            width: 100%;
            max-width: 450px;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5);
            position: relative;
            z-index: 10;
            overflow: hidden;
        }
        
        .login-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, 
                transparent, 
                rgba(255, 255, 255, 0.1), 
                transparent);
            animation: shimmerLogin 3s infinite;
            z-index: 1;
        }
        
        @keyframes shimmerLogin {
            0% { left: -100%; }
            100% { left: 100%; }
        }
        
        .login-box {
            background: rgba(10, 10, 10, 0.8);
            backdrop-filter: blur(20px);
            padding: 2.5rem;
            border-radius: 1.5rem;
            box-shadow: 0 25px 50px rgba(0,0,0,0.25);
            width: 100%;
            max-width: 400px;
            position: relative;
            z-index: 10;
        }
        
        .admin-header {
            background: linear-gradient(135deg, 
                rgba(0, 0, 0, 0.98) 0%, 
                rgba(20, 25, 45, 0.95) 30%, 
                rgba(45, 55, 85, 0.92) 70%, 
                rgba(0, 0, 0, 0.98) 100%);
            backdrop-filter: blur(25px);
            color: white;
            position: relative;
            overflow: hidden;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }
        
        .admin-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, 
                transparent 0%, 
                rgba(102, 126, 234, 0.15) 25%,
                rgba(139, 69, 19, 0.1) 50%,
                rgba(75, 0, 130, 0.12) 75%,
                transparent 100%);
            animation: shimmer 6s ease-in-out infinite;
        }
        
        @keyframes shimmer {
            0%, 100% { transform: translateX(-100%); opacity: 0; }
            50% { transform: translateX(100%); opacity: 1; }
        }
        
        .section-card {
            background: linear-gradient(145deg, 
                rgba(15, 15, 25, 0.9) 0%,
                rgba(25, 25, 35, 0.85) 50%,
                rgba(35, 35, 45, 0.9) 100%);
            backdrop-filter: blur(30px);
            border-radius: 24px;
            box-shadow: 
                0 20px 40px rgba(0, 0, 0, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.15),
                inset 0 -1px 0 rgba(0, 0, 0, 0.2);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            color: white;
            position: relative;
            overflow: hidden;
        }
        
        .section-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg,
                transparent 30%,
                rgba(255, 255, 255, 0.03) 50%,
                transparent 70%);
            opacity: 0.7;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, 
                #667eea 0%, 
                #764ba2 50%, 
                #667eea 100%);
            border: none;
            border-radius: 16px;
            padding: 1rem 2rem;
            color: white;
            font-weight: 700;
            font-size: 1rem;
            letter-spacing: 0.5px;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            font-family: 'Signika', sans-serif;
            position: relative;
            overflow: hidden;
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
            transform-origin: center;
        }
        
        .btn-primary::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg,
                transparent,
                rgba(255, 255, 255, 0.3),
                transparent);
            transition: left 0.5s ease;
        }
        
        .btn-primary:hover::before {
            left: 100%;
        }
        
        .btn-primary:hover {
            transform: translateY(-3px) scale(1.02);
            box-shadow: 0 15px 35px rgba(102, 126, 234, 0.4);
        }
        
        .btn-primary:active {
            transform: translateY(-1px) scale(0.98);
        }
        
        .btn-success {
            background: linear-gradient(135deg, 
                #10b981 0%, 
                #059669 50%, 
                #047857 100%);
            border: none;
            border-radius: 12px;
            padding: 0.75rem 1.5rem;
            color: white;
            font-weight: 600;
            font-size: 0.875rem;
            letter-spacing: 0.3px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-family: 'Signika', sans-serif;
            cursor: pointer;
            box-shadow: 0 6px 20px rgba(16, 185, 129, 0.3);
        }
        
        .btn-success:hover {
            transform: translateY(-2px) scale(1.02);
            box-shadow: 0 10px 30px rgba(16, 185, 129, 0.4);
        }
        
        .text-editor {
            background: rgba(0, 0, 0, 0.7);
            border-radius: 12px;
            padding: 1rem;
            color: white;
            font-family: 'Signika', sans-serif;
            font-size: 16px;
            line-height: 1.6;
            resize: vertical;
            min-height: 120px;
            backdrop-filter: blur(10px);
            box-shadow: inset 0 2px 8px rgba(0, 0, 0, 0.5);
        }
        
        .text-editor:focus {
            outline: none;
            box-shadow: 
                inset 0 2px 8px rgba(0, 0, 0, 0.7),
                0 0 0 2px rgba(102, 126, 234, 0.3);
            background: rgba(0, 0, 0, 0.8);
        }
        
        .text-editor::placeholder {
            color: rgba(255, 255, 255, 0.4);
        }
        
        .hidden { 
            display: none !important; 
        }
        
        /* Styles pour le champ mot de passe */
        input[type="password"] {
            box-shadow: inset 0 2px 8px rgba(0, 0, 0, 0.5);
            font-size: 16px;
            font-weight: 600;
            letter-spacing: 0.5px;
            color: #ffffff !important;
            background: rgba(0, 0, 0, 0.7) !important;
        }
        
        input[type="password"]:focus {
            box-shadow: 
                inset 0 2px 8px rgba(0, 0, 0, 0.7),
                0 0 0 2px rgba(102, 126, 234, 0.3);
            background: rgba(0, 0, 0, 0.8) !important;
            color: #ffffff !important;
        }
        
        input[type="password"]::placeholder {
            color: rgba(255, 255, 255, 0.4) !important;
            font-weight: 400;
        }
        
        .text-section {
            margin-bottom: 2rem;
            padding: 1.5rem;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 16px;
            backdrop-filter: blur(10px);
        }
        
        .text-section h3 {
            color: rgba(102, 126, 234, 1);
            font-size: 1.25rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }
        
        .text-section p {
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.875rem;
            margin-bottom: 1rem;
        }
        
        .save-indicator {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 0.75rem 1.5rem;
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            border-radius: 12px;
            font-weight: 600;
            z-index: 1000;
            transform: translateX(100%);
            transition: transform 0.3s ease;
        }
        
        .save-indicator.show {
            transform: translateX(0);
        }
    </style>
</head>
<body class="bg-black text-white font-signika">
    <!-- Login Form -->
    <div id="login-container" class="login-container">
        <div class="login-box">
            <h1 class="text-3xl font-bold text-center mb-8 text-white font-signika">Éditeur de Textes</h1>
            <div id="login-error" class="hidden bg-red-500/20 text-red-200 px-4 py-3 rounded-lg mb-6 backdrop-blur-sm">
                Mot de passe incorrect
            </div>
            <form id="login-form">
                <div class="mb-6">
                    <label class="block text-white/80 text-sm font-semibold mb-3 font-signika" for="password">
                        Mot de passe
                    </label>
                    <input type="password" id="password" class="w-full py-3 px-4 text-white bg-black/70 backdrop-blur-sm rounded-xl leading-tight focus:outline-none focus:bg-black/80 transition-all duration-300 placeholder-white/50" placeholder="Entrez votre mot de passe" required>
                </div>
                <button type="submit" class="btn-primary text-white font-bold py-3 px-4 rounded-xl w-full transition-all duration-300 font-signika">
                    Se connecter
                </button>
            </form>
        </div>
    </div>

    <!-- Text Editor Panel -->
    <div id="editor-panel" class="hidden">
        <header class="admin-header shadow-lg">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between h-20 items-center">
                    <div class="flex items-center space-x-6">
                        <div class="relative">
                            <div class="w-12 h-12 bg-white/20 backdrop-blur-sm rounded-xl flex items-center justify-center ring-2 ring-white/30">
                                <svg class="w-7 h-7" fill="currentColor" viewBox="0 0 24 24">
                                    <path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/>
                                </svg>
                            </div>
                            <div class="absolute -top-1 -right-1 w-4 h-4 bg-green-400 rounded-full border-2 border-white animate-pulse"></div>
                        </div>
                        <div>
                            <h1 class="text-2xl font-bold text-white">Éditeur de Textes</h1>
                            <p class="text-white/70 text-sm font-medium">Gestion des contenus du portfolio</p>
                        </div>
                    </div>
                    <div class="flex items-center space-x-6">
                        <div class="hidden md:flex items-center space-x-4 text-white/80 bg-white/10 px-4 py-2 rounded-xl backdrop-blur-sm">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                            </svg>
                            <span id="current-time" class="text-sm font-bold"></span>
                        </div>
                        <a href="/admin" class="group bg-blue-500/80 hover:bg-blue-600/90 text-white font-bold py-3 px-6 rounded-xl transition-all duration-300 flex items-center space-x-2 backdrop-blur-sm shadow-lg hover:shadow-xl transform hover:scale-105">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                            </svg>
                            <span>Photos</span>
                        </a>
                        <button id="logout-btn" class="group bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white font-bold py-3 px-6 rounded-xl transition-all duration-300 flex items-center space-x-2 backdrop-blur-sm shadow-lg hover:shadow-xl transform hover:scale-105">
                            <svg class="w-5 h-5 group-hover:rotate-12 transition-transform duration-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"/>
                            </svg>
                            <span>Déconnexion</span>
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <main class="max-w-7xl mx-auto py-12 px-4 sm:px-6 lg:px-8 min-h-screen relative">
            <div class="fixed inset-0 -z-10">
                <div class="absolute inset-0 bg-gradient-to-br from-black via-gray-900 to-black"></div>
                <div class="absolute inset-0 bg-[url('data:image/svg+xml,%3Csvg width=\"40\" height=\"40\" viewBox=\"0 0 40 40\" xmlns=\"http://www.w3.org/2000/svg\"%3E%3Cg fill=\"%23ffffff\" fill-opacity=\"0.02\"%3E%3Ccircle cx=\"20\" cy=\"20\" r=\"1\"/%3E%3C/g%3E%3C/svg%3E')] opacity-30"></div>
                <div class="absolute top-0 left-1/4 w-96 h-96 bg-purple-600/10 rounded-full blur-3xl"></div>
                <div class="absolute bottom-0 right-1/4 w-96 h-96 bg-blue-600/10 rounded-full blur-3xl"></div>
                <div class="absolute top-1/2 left-1/2 w-96 h-96 bg-indigo-600/5 rounded-full blur-3xl transform -translate-x-1/2 -translate-y-1/2"></div>
            </div>

            <!-- Save Indicator -->
            <div id="save-indicator" class="save-indicator">
                ✅ Sauvegardé avec succès !
            </div>

            <!-- Main Content Editor -->
            <div class="section-card p-8">
                <div class="flex justify-between items-center mb-8 bg-gradient-to-r from-indigo-900/20 to-purple-900/20 p-6 rounded-xl">
                    <div>
                        <h2 class="text-3xl font-bold text-white font-signika mb-2">Éditeur de Contenu</h2>
                        <p class="text-white/70 font-medium text-lg">Modifiez tous les textes de votre portfolio</p>
                    </div>
                    <button id="save-all-btn" class="btn-success flex items-center space-x-2 shadow-lg hover:shadow-xl transform hover:scale-105">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3-3m0 0l-3 3m3-3v12"/>
                        </svg>
                        <span>Sauvegarder Tout</span>
                    </button>
                </div>

                <div id="text-sections" class="space-y-6">
                    <!-- Informations principales -->
                    <div class="text-section">
                        <h3>👤 Informations Principales</h3>
                        <p>Modifiez les informations principales de votre site</p>
                        
                        <div class="mt-4">
                            <label class="block text-white/90 text-sm font-semibold mb-2">Nom Principal</label>
                            <textarea id="main.nom" class="text-editor w-full" placeholder="Votre nom complet">Mattia PARRINELLO</textarea>
                        </div>
                    </div>

                    <!-- Section À Propos -->
                    <div class="text-section">
                        <h3>👨‍💼 Section À Propos</h3>
                        <p>Personnalisez le contenu de votre page "À propos"</p>
                        
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                            <div>
                                <label class="block text-white/90 text-sm font-semibold mb-2">Message de Présentation</label>
                                <textarea id="a propos.presentation" class="text-editor w-full" placeholder="Ex: Salut, je suis...">Salut, je suis Mattia</textarea>
                            </div>
                            <div>
                                <label class="block text-white/90 text-sm font-semibold mb-2">Avatar (chemin de l'image)</label>
                                <textarea id="a propos.avatar" class="text-editor w-full" placeholder="/dist/assets/Avatar.png">/dist/assets/Avatar.png</textarea>
                            </div>
                        </div>
                        
                        <div class="mt-6">
                            <label class="block text-white/90 text-sm font-semibold mb-3">Biographie (Paragraphes)</label>
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-white/70 text-xs font-medium mb-1">Paragraphe 1</label>
                                    <textarea id="a propos.bio.0" class="text-editor w-full" style="min-height: 120px;" placeholder="Premier paragraphe de votre bio...">Je suis Mattia, photographe passionné de 18 ans basé en région parisienne. Je me spécialise dans la photo de rue et le portrait, des domaines qui me permettent de capturer des instants authentiques, des émotions vraies et des histoires uniques à travers mes images. Mon objectif est de créer des photos à la fois esthétiques et porteuses de sens, qui reflètent la personnalité et l'énergie de chaque sujet.</textarea>
                                </div>
                                
                                <div>
                                    <label class="block text-white/70 text-xs font-medium mb-1">Paragraphe 2</label>
                                    <textarea id="a propos.bio.1" class="text-editor w-full" style="min-height: 120px;" placeholder="Deuxième paragraphe...">Depuis mes débuts, j'ai exploré différentes approches, expérimenté avec la lumière et les couleurs, et cherché à développer une signature visuelle qui me ressemble. Aujourd'hui, je souhaite élargir mon univers vers la photographie de concerts et d'événements, attiré par l'intensité des émotions et l'énergie palpable que ces moments dégagent.</textarea>
                                </div>
                                
                                <div>
                                    <label class="block text-white/70 text-xs font-medium mb-1">Paragraphe 3</label>
                                    <textarea id="a propos.bio.2" class="text-editor w-full" style="min-height: 120px;" placeholder="Troisième paragraphe...">Quand je ne suis pas derrière l'objectif, j'aime arpenter la ville à la recherche de scènes spontanées, explorer de nouvelles perspectives et tester différentes techniques. Je crois que chaque instant peut devenir une image mémorable, et j'espère pouvoir partager cette passion et ce regard unique à travers des projets collaboratifs ou personnels.</textarea>
                                </div>
                                
                                <div>
                                    <label class="block text-white/70 text-xs font-medium mb-1">Paragraphe 4</label>
                                    <textarea id="a propos.bio.3" class="text-editor w-full" style="min-height: 120px;" placeholder="Quatrième paragraphe...">Merci d'avoir pris le temps de découvrir mon univers. Si mon travail vous parle, si vous avez un projet ou une idée que vous aimeriez concrétiser, je serais ravi d'en discuter. Ensemble, donnons vie à des images qui resteront gravées dans le temps.</textarea>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Section Footer -->
                    <div class="text-section">
                        <h3>📞 Informations de Contact (Footer)</h3>
                        <p>Modifiez les informations de contact affichées dans le footer</p>
                        
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                            <div>
                                <label class="block text-white/90 text-sm font-semibold mb-2">Adresse</label>
                                <textarea id="footer.ligne1" class="text-editor w-full" placeholder="Votre adresse complète">1 rue Victor Basch Franconville 95130</textarea>
                            </div>
                            <div>
                                <label class="block text-white/90 text-sm font-semibold mb-2">Téléphone</label>
                                <textarea id="footer.ligne2" class="text-editor w-full" placeholder="Votre numéro de téléphone">(+33) 6 50 58 62 51</textarea>
                            </div>
                        </div>
                        
                        <div class="mt-4">
                            <label class="block text-white/90 text-sm font-semibold mb-2">Instagram (nom d'utilisateur)</label>
                            <textarea id="footer.instagram" class="text-editor w-full" placeholder="Nom d'utilisateur Instagram sans @">mattia_jpeg</textarea>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        // Check session status on page load
        async function checkSession() {
            try {
                const response = await fetch('/admin/session-status', {
                    credentials: 'same-origin' // Important pour les cookies de session
                });
                const data = await response.json();
                
                if (data.isLoggedIn) {
                    // User is already logged in, show editor
                    document.getElementById('login-container').classList.add('hidden');
                    document.getElementById('editor-panel').classList.remove('hidden');
                    loadTexts();
                    updateTime();
                    setInterval(updateTime, 1000);
                } else {
                    // User needs to log in
                    document.getElementById('login-container').classList.remove('hidden');
                    document.getElementById('editor-panel').classList.add('hidden');
                }
            } catch (error) {
                console.error('Erreur lors de la vérification de session:', error);
                // En cas d'erreur, afficher la connexion par sécurité
                document.getElementById('login-container').classList.remove('hidden');
                document.getElementById('editor-panel').classList.add('hidden');
            }
        }

        // Call checkSession when page loads
        document.addEventListener('DOMContentLoaded', checkSession);

        // Authentication
        document.getElementById('login-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const password = document.getElementById('password').value;
            const errorDiv = document.getElementById('login-error');
            
            try {
                const response = await fetch('/admin/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ password }),
                    credentials: 'same-origin' // Important pour les cookies de session
                });
                
                if (response.ok) {
                    document.getElementById('login-container').classList.add('hidden');
                    document.getElementById('editor-panel').classList.remove('hidden');
                    loadTexts();
                    updateTime();
                    setInterval(updateTime, 1000);
                } else {
                    errorDiv.classList.remove('hidden');
                    setTimeout(() => errorDiv.classList.add('hidden'), 3000);
                }
            } catch (error) {
                console.error('Erreur de connexion:', error);
                errorDiv.classList.remove('hidden');
                setTimeout(() => errorDiv.classList.add('hidden'), 3000);
            }
        });

        // Logout
        document.getElementById('logout-btn').addEventListener('click', () => {
            fetch('/admin/logout', { method: 'POST' })
                .then(() => {
                    document.getElementById('editor-panel').classList.add('hidden');
                    document.getElementById('login-container').classList.remove('hidden');
                    document.getElementById('password').value = '';
                });
        });

        // Time display
        function updateTime() {
            const now = new Date();
            document.getElementById('current-time').textContent = now.toLocaleTimeString('fr-FR');
        }

        // Save all texts
        document.getElementById('save-all-btn').addEventListener('click', async () => {
            const texts = {
                "main": {},
                "a propos": {
                    "bio": []
                },
                "footer": {}
            };
            
            // Collect all text data
            const textareas = document.querySelectorAll('.text-editor');
            textareas.forEach(textarea => {
                const id = textarea.id;
                const value = textarea.value;
                
                if (id === 'main.nom') {
                    texts.main.nom = value;
                } else if (id === 'a propos.presentation') {
                    texts["a propos"].presentation = value;
                } else if (id === 'a propos.avatar') {
                    texts["a propos"].avatar = value;
                } else if (id.startsWith('a propos.bio.')) {
                    const index = parseInt(id.split('.')[2]);
                    texts["a propos"].bio[index] = value;
                } else if (id === 'footer.ligne1') {
                    texts.footer.ligne1 = value;
                } else if (id === 'footer.ligne2') {
                    texts.footer.ligne2 = value;
                } else if (id === 'footer.instagram') {
                    texts.footer.instagram = value;
                }
            });
            
            try {
                const response = await fetch('/admin/texts', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(texts),
                    credentials: 'same-origin' // Important pour les cookies de session
                });
                
                if (response.ok) {
                    showSaveIndicator();
                } else if (response.status === 401) {
                    // Session expirée, rediriger vers la connexion
                    alert('Session expirée. Vous allez être redirigé vers la page de connexion.');
                    window.location.reload();
                } else {
                    console.error('Erreur lors de la sauvegarde:', response.status);
                    alert('Erreur lors de la sauvegarde. Vérifiez votre connexion.');
                }
            } catch (error) {
                console.error('Erreur:', error);
                alert('Erreur de connexion au serveur.');
            }
        });

        // Load existing texts
        async function loadTexts() {
            try {
                const response = await fetch('/admin/texts', {
                    credentials: 'same-origin' // Important pour les cookies de session
                });
                
                if (response.ok) {
                    const texts = await response.json();
                    
                    // Fill textareas with existing data
                    if (texts.main && texts.main.nom) {
                        const mainNom = document.getElementById('main.nom');
                        if (mainNom) mainNom.value = texts.main.nom;
                    }
                    
                    if (texts["a propos"]) {
                        if (texts["a propos"].presentation) {
                            const presentation = document.getElementById('a propos.presentation');
                            if (presentation) presentation.value = texts["a propos"].presentation;
                        }
                        
                        if (texts["a propos"].avatar) {
                            const avatar = document.getElementById('a propos.avatar');
                            if (avatar) avatar.value = texts["a propos"].avatar;
                        }
                        
                        if (texts["a propos"].bio && Array.isArray(texts["a propos"].bio)) {
                            texts["a propos"].bio.forEach((bioText, index) => {
                                const bioElement = document.getElementById(`a propos.bio.${index}`);
                                if (bioElement) bioElement.value = bioText;
                            });
                        }
                    }
                    
                    if (texts.footer) {
                        if (texts.footer.ligne1) {
                            const ligne1 = document.getElementById('footer.ligne1');
                            if (ligne1) ligne1.value = texts.footer.ligne1;
                        }
                        if (texts.footer.ligne2) {
                            const ligne2 = document.getElementById('footer.ligne2');
                            if (ligne2) ligne2.value = texts.footer.ligne2;
                        }
                        if (texts.footer.instagram) {
                            const instagram = document.getElementById('footer.instagram');
                            if (instagram) instagram.value = texts.footer.instagram;
                        }
                    }
                } else if (response.status === 401) {
                    // Session expirée, retourner à la connexion
                    document.getElementById('editor-panel').classList.add('hidden');
                    document.getElementById('login-container').classList.remove('hidden');
                } else {
                    console.error('Erreur lors du chargement des textes:', response.status);
                }
            } catch (error) {
                console.error('Erreur lors du chargement des textes:', error);
            }
        }

        // Show save indicator
        function showSaveIndicator() {
            const indicator = document.getElementById('save-indicator');
            indicator.classList.add('show');
            setTimeout(() => {
                indicator.classList.remove('show');
            }, 3000);
        }

        // Auto-save functionality (optional)
        let saveTimeout;
        document.addEventListener('input', (e) => {
            if (e.target.classList.contains('text-editor')) {
                clearTimeout(saveTimeout);
                saveTimeout = setTimeout(() => {
                    document.getElementById('save-all-btn').click();
                }, 2000); // Auto-save after 2 seconds of no typing
            }
        });
    </script>
</body>
</html>
