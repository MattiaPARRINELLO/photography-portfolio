<!DOCTYPE html>
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- META_PLACEHOLDER_START -->
    <title>{{DYNAMIC_TITLE}}</title>
    <meta name="description" content="{{DYNAMIC_DESCRIPTION}}" />
    <!-- META_PLACEHOLDER_END -->
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="../dist/assets/Logo_MP.svg" />
    <link rel="stylesheet" href="../dist/css/output.css" />
    <!-- Alpine.js -->
    <script
      defer
      src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"
    ></script>
    <!-- Start - Fonts -->
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link
      href="https://fonts.googleapis.com/css2?family=Signika:wght@400;700&display=swap"
      rel="stylesheet"
    />
    <!-- End - Fonts -->
    <!-- Start - Fancybox Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/exifr/dist/full.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0/dist/fancybox/fancybox.umd.js"></script>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0/dist/fancybox/fancybox.css"
    />
    <script
      src="https://code.jquery.com/jquery-3.6.3.min.js"
      integrity="sha256-pvPw+upLPUjgMXY0G+8O0xUf+/Im1MZjXxxgOcBQBXU="
      crossorigin="anonymous"
    ></script>
    <!-- End - Fancybox Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/macy@2.5.1/dist/macy.min.js"></script>
    <script defer>
      // Fonction pour initialiser Macy.js apr√®s le chargement des images
      function initMacy() {
        if (window.macyInstance) {
          window.macyInstance.recalculate(true);
          return;
        }
        window.macyInstance = Macy({
          container: "#gallery-masonry",
          trueOrder: true,
          waitForImages: true,
          margin: {
            x: 20,
            y: 20
          },
          columns: 4,
          breakAt: {
            1400: 3,
            1024: 2,
            768: 2,
            640: 1,
          },
          horizontalOrder: true,
        });
      }

      // Fonction pour charger les images et initialiser la grille
      async function loadGallery() {
        const res = await fetch("/photos-list");
        const photos = await res.json();
        const gallery = document.getElementById("gallery-masonry");
        gallery.innerHTML = "";
        
        // Ajouter un indicateur de chargement
        const loadingDiv = document.createElement("div");
        loadingDiv.className = "col-span-full text-center py-12";
        loadingDiv.innerHTML = `
          <div class="inline-flex items-center text-gray-600 dark:text-gray-300">
            <svg class="animate-spin -ml-1 mr-3 h-8 w-8" fill="none" viewBox="0 0 24 24">
              <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
              <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
            </svg>
            Chargement de la galerie...
          </div>
        `;
        gallery.appendChild(loadingDiv);
        
        // Charger les photos avec un d√©lai pour l'animation
        await new Promise(resolve => setTimeout(resolve, 500));
        gallery.removeChild(loadingDiv);
        
        photos.forEach((photo, index) => {
          const div = document.createElement("div");
          div.className = "gallery-item";
          div.style.animationDelay = `${0.1 + (index * 0.05)}s`;
          
          const a = document.createElement("a");
          a.href = photo.url;
          a.setAttribute("data-fancybox", "gallery");
          a.setAttribute("data-file", photo.filename);
          
          const img = document.createElement("img");
          img.src = photo.thumbnailUrl || photo.url;
          img.alt = photo.filename;
          img.loading = "lazy";
          img.className = "gallery-image w-full rounded-xl shadow-lg object-cover object-center animate-fade-in transition-all duration-700 hover:scale-105 transform-gpu";
          
          // Ajout d'un overlay subtil au hover
          const overlay = document.createElement("div");
          overlay.className = "gallery-overlay absolute inset-0 bg-black bg-opacity-0 transition-all duration-500 rounded-xl flex items-center justify-center opacity-0 hover:opacity-100 hover:bg-opacity-20";
          
          const zoomIcon = document.createElement("div");
          zoomIcon.innerHTML = `
            <svg class="w-8 h-8 text-white drop-shadow-lg" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM10 7v3m0 0v3m0-3h3m-3 0H7"/>
            </svg>
          `;
          overlay.appendChild(zoomIcon);
          
          // Container pour l'image avec position relative
          const imageContainer = document.createElement("div");
          imageContainer.className = "relative overflow-hidden rounded-xl group";
          imageContainer.appendChild(img);
          imageContainer.appendChild(overlay);
          
          a.appendChild(imageContainer);
          div.appendChild(a);
          gallery.appendChild(div);
          
          // Pr√©-chargement EXIF et ajout dans data-caption
          img.addEventListener("load", async () => {
            try {
              const exif = await exifr.parse(photo.url, {
                translateValues: false,
              });
              if (exif) {
                let infos = [];
                if (exif.Model)
                  infos.push(`üì∑ <b>Appareil :</b> ${exif.Model}`);
                if (exif.LensModel)
                  infos.push(`üîç <b>Objectif :</b> ${exif.LensModel}`);
                if (exif.FNumber)
                  infos.push(`üåû <b>Ouverture :</b> f/${exif.FNumber}`);
                if (exif.ExposureTime)
                  infos.push(
                    `‚è±Ô∏è <b>Vitesse :</b> 1/${Math.round(
                      1 / exif.ExposureTime
                    )}s`
                  );
                if (exif.ISO) infos.push(`üß¨ <b>ISO :</b> ${exif.ISO}`);
                if (infos.length)
                  a.setAttribute(
                    "data-caption",
                    `<div class='exif-info-fb text-xs text-gray-200 bg-black/70 rounded p-2 mt-2'>${infos.join(
                      " | "
                    )}</div>`
                  );
              }
            } catch (e) {
              console.error("Error parsing EXIF data:", e);
            }
          });
        });
        
        // Attendre que toutes les images soient charg√©es avant d'initialiser Macy
        const images = Array.from(gallery.querySelectorAll("img"));
        await Promise.all(
          images.map((img) => {
            if (img.complete) return Promise.resolve();
            return new Promise((res) => {
              img.onload = img.onerror = res;
            });
          })
        );
        initMacy();
      }

      document.addEventListener("DOMContentLoaded", loadGallery);
      // Initialisation simple de Fancybox (caption auto)
      Fancybox.bind('[data-fancybox="gallery"]', {});
    </script>
  </head>

  <body
    class="dark:bg-black bg-white h-screen text-black dark:text-white px-5 md:px-20 opacity-0 animate-fade-in transition duration-500"
  >
    <!-- Navbar -->
    <header class="flex w-full overflow-hidden pt-10 pb-1">
      <!-- Navbar -->
      <nav id="nav" x-data="{ open: false }" role="navigation" class="w-full">
        <div
          class="container mx-auto flex flex-wrap items-center md:flex-no-wrap"
        >
          <div class="mr-4 md:mr-8">
            <a href="index.html" class="text-2xl font-signika font-bold"
              >MATTIA PARRINELLO</a
            >
          </div>
          <div class="ml-auto md:hidden flex items-center justify-start">
            <button
              onclick="menuToggle()"
              @click="open = !open"
              class="tap-highlight-transparent text-black dark:text-white w-5 h-5 relative focus:outline-none"
              @click="open = !open"
            >
              <span class="sr-only">Ouvrir le menu principal</span>
              <div
                class="block w-5 absolute left-1/2 top-1/2 transform -translate-x-1/2 -translate-y-1/2"
              >
                <span
                  aria-hidden="true"
                  class="block absolute h-0.5 w-5 bg-current transform transition duration-500 ease-in-out"
                  :class="{'rotate-45': open,' -translate-y-1.5': !open }"
                ></span>
                <span
                  aria-hidden="true"
                  class="block absolute h-0.5 w-5 bg-current transform transition duration-500 ease-in-out"
                  :class="{'opacity-0': open } "
                ></span>
                <span
                  aria-hidden="true"
                  class="block absolute h-0.5 w-5 bg-current transform transition duration-500 ease-in-out"
                  :class="{'-rotate-45': open, ' translate-y-1.5': !open}"
                ></span>
              </div>
            </button>
          </div>
          <div
            id="menu"
            class="w-full h-0 transition-all ease-out duration-500 md:transition-none md:w-auto md:flex-grow md:flex md:items-center"
          >
            <ul
              id="ulMenu"
              class="flex flex-col duration-300 ease-out md:space-x-5 sm:transition-none mt-5 md:flex-row md:items-center md:ml-auto md:mt-0 md:pt-0 md:border-0"
            >
              <li class="group transition duration-300">
                <a
                  href="/portfolio"
                  class="font-signika text-2xl tap-highlight-transparent"
                  >PORTFOLIO
                  <span
                    class="hidden md:block h-0.5 bg-black dark:bg-white"
                  ></span>
                </a>
              </li>
              <li class="group transition duration-300">
                <a
                  href="/a-propos"
                  class="font-signika text-2xl tap-highlight-transparent"
                  >√Ä PROPOS
                  <span
                    class="hidden md:block max-w-0 group-hover:max-w-full transition-all duration-500 h-0.5 bg-black dark:bg-white"
                  ></span>
                </a>
              </li>
              <li class="group transition duration-300">
                <a
                  href="/contact"
                  class="font-signika text-2xl tap-highlight-transparent"
                  >CONTACT
                  <span
                    class="hidden md:block max-w-0 group-hover:max-w-full transition-all duration-500 h-0.5 bg-black dark:bg-white"
                  ></span>
                </a>
              </li>
            </ul>
          </div>
        </div>
      </nav>
    </header>
    <!-- Content -->
    <div class="container mx-auto">
      <h1 class="text-4xl pt-10 pb-8 font-bold">PORTFOLIO</h1>
      <section class="text-neutral-700">
        <div class="container mx-auto">
          <div
            id="gallery-masonry"
            class="gallery-masonry"
            style="column-count: 3; column-gap: 1rem"
          ></div>
          <style>
            /* Styles Masonry am√©lior√©s avec animations fluides */
            .gallery-masonry {
              display: flex;
              flex-wrap: wrap;
              gap: 20px;
              align-items: flex-start;
              width: 100%;
              padding: 10px;
              scroll-behavior: smooth;
            }
            
            .gallery-masonry .gallery-item {
              margin-bottom: 0;
              width: auto;
              display: block;
              overflow: hidden;
              transition: all 0.6s cubic-bezier(0.23, 1, 0.32, 1);
              backface-visibility: hidden;
              perspective: 1000px;
              animation: fadeInUp 0.8s ease-out forwards;
              opacity: 0;
              transform: translateY(30px) translateZ(0);
            }
            
            @keyframes fadeInUp {
              to {
                opacity: 1;
                transform: translateY(0) translateZ(0);
              }
            }
            
            .gallery-masonry .gallery-item:nth-child(1) { animation-delay: 0.1s; }
            .gallery-masonry .gallery-item:nth-child(2) { animation-delay: 0.15s; }
            .gallery-masonry .gallery-item:nth-child(3) { animation-delay: 0.2s; }
            .gallery-masonry .gallery-item:nth-child(4) { animation-delay: 0.25s; }
            .gallery-masonry .gallery-item:nth-child(5) { animation-delay: 0.3s; }
            .gallery-masonry .gallery-item:nth-child(6) { animation-delay: 0.35s; }
            .gallery-masonry .gallery-item:nth-child(n+7) { animation-delay: 0.4s; }
            
            .gallery-masonry .gallery-item:hover {
              z-index: 10;
              position: relative;
            }
            
            .gallery-image {
              transition: all 0.7s cubic-bezier(0.25, 0.46, 0.45, 0.94);
              will-change: transform, filter, box-shadow;
              box-shadow: 
                0 4px 20px rgba(0, 0, 0, 0.08),
                0 1px 3px rgba(0, 0, 0, 0.1);
              border-radius: 16px;
              background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
              background-size: 200% 100%;
              animation: shimmer 2s infinite linear;
              position: relative;
              overflow: hidden;
            }
            
            .gallery-image[src] {
              animation: none;
              background: linear-gradient(45deg, #f0f0f0, #e8e8e8);
            }
            
            .gallery-masonry .gallery-item:hover .gallery-image {
              transform: scale(1.05) translateY(-8px) rotateX(2deg);
              box-shadow: 
                0 25px 60px rgba(0, 0, 0, 0.15),
                0 8px 25px rgba(0, 0, 0, 0.1),
                0 0 0 1px rgba(255, 255, 255, 0.1);
              filter: contrast(1.1) saturate(1.1) brightness(1.05);
              border-radius: 20px;
            }
            
            .gallery-overlay {
              backdrop-filter: blur(2px);
              transition: all 0.5s cubic-bezier(0.23, 1, 0.32, 1);
            }
            
            .gallery-masonry .gallery-item:hover .gallery-overlay {
              opacity: 1 !important;
              background-color: rgba(0, 0, 0, 0.15) !important;
            }
            
            @keyframes shimmer {
              0% { background-position: -200% 0; }
              100% { background-position: 200% 0; }
            }
            
            /* Responsive improvements */
            @media (max-width: 768px) {
              .gallery-masonry {
                gap: 15px;
                padding: 5px;
              }
              
              .gallery-masonry .gallery-item:hover .gallery-image {
                transform: scale(1.02) translateY(-2px);
                box-shadow: 0 8px 25px rgba(0, 0, 0, 0.12);
              }
            }
            
            /* Dark mode improvements */
            @media (prefers-color-scheme: dark) {
              .gallery-image {
                background: linear-gradient(45deg, #2a2a2a, #1e1e1e);
                box-shadow: 
                  0 4px 20px rgba(0, 0, 0, 0.3),
                  0 1px 3px rgba(0, 0, 0, 0.5);
              }
              
              .gallery-masonry .gallery-item:hover .gallery-image {
                box-shadow: 
                  0 25px 60px rgba(0, 0, 0, 0.4),
                  0 8px 25px rgba(0, 0, 0, 0.3),
                  0 0 0 1px rgba(255, 255, 255, 0.1);
              }
            }
          </style>
        </div>
      </section>
    </div>
    <!-- Footer -->
    <footer>
      <div class="max-w-screen-xl py-16 mx-auto">
        <div class="grid grid-cols-1 gap-8 text-center mx-auto">
          <div>
            <p class="font-signika"><b>MATTIA PARRINELLO</b></p>
            <p class="mt-4 text-sm text-gray-600 dark:text-gray-300">
              1 rue Victor Basch Franconville, 95130<br />(+33) 6 50 58 62 51
            </p>
            <div class="flex mx-auto">
              <div
                class="mx-auto space-x-6 flex mt-8 text-gray-600 dark:text-gray-300"
              >
                <a
                  class="transition duration-300 hover:opacity-75"
                  href="https://www.instagram.com/mattia_jpeg"
                  target="_blank"
                  rel="noreferrer"
                >
                  <span class="sr-only"> Instagram </span>
                  <svg
                    class="w-6 h-6"
                    fill="currentColor"
                    viewBox="0 0 16 16"
                    aria-hidden="true"
                  >
                    <path
                      d="M8 0C5.829 0 5.556.01 4.703.048 3.85.088 3.269.222 2.76.42a3.917 3.917 0 0 0-1.417.923A3.927 3.927 0 0 0 .42 2.76C.222 3.268.087 3.85.048 4.7.01 5.555 0 5.827 0 8.001c0 2.172.01 2.444.048 3.297.04.852.174 1.433.372 1.942.205.526.478.972.923 1.417.444.445.89.719 1.416.923.51.198 1.09.333 1.942.372C5.555 15.99 5.827 16 8 16s2.444-.01 3.298-.048c.851-.04 1.434-.174 1.943-.372a3.916 3.916 0 0 0 1.416-.923c.445-.445.718-.891.923-1.417.197-.509.332-1.09.372-1.942C15.99 10.445 16 10.173 16 8s-.01-2.445-.048-3.299c-.04-.851-.175-1.433-.372-1.941a3.926 3.926 0 0 0-.923-1.417A3.911 3.911 0 0 0 13.24.42c-.51-.198-1.092-.333-1.943-.372C10.443.01 10.172 0 7.998 0h.003zm-.717 1.442h.718c2.136 0 2.389.007 3.232.046.78.035 1.204.166 1.486.275.373.145.64.319.92.599.28.28.453.546.598.92.11.281.24.705.275 1.485.039.843.047 1.096.047 3.231s-.008 2.389-.047 3.232c-.035.78-.166 1.203-.275 1.485a2.47 2.47 0 0 1-.599.919c-.28.28-.546.453-.92.598-.28.11-.704.24-1.485.276-.843.038-1.096.047-3.232.047s-2.39-.009-3.233-.047c-.78-.036-1.203-.166-1.485-.276a2.478 2.478 0 0 1-.92-.598 2.48 2.48 0 0 1-.6-.92c-.109-.281-.24-.705-.275-1.485-.038-.843-.046-1.096-.046-3.233 0-2.136.008-2.388.046-3.231.036-.78.166-1.204.276-1.486.145-.373.319-.64.599-.92.28-.28.546-.453.92-.598.282-.11.705-.24 1.485-.276.738-.034 1.024-.044 2.515-.045v.002zm4.988 1.328a.96.96 0 1 0 0 1.92.96.96 0 0 0 0-1.92zm-4.27 1.122a4.109 4.109 0 1 0 0 8.217 4.109 4.109 0 0 0 0-8.217zm0 1.441a2.667 2.667 0 1 1 0 5.334 2.667 2.667 0 0 1 0-5.334z"
                    />
                  </svg>
                </a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </footer>
    <!-- Script for the LightBox -->
    <script>
      Fancybox.bind("[data-fancybox]", {});
    </script>
    <script src="../dist/js/fade_in.js"></script>
    <script src="../dist/js/menu.js"></script>
    <script src="../dist/js/text-loader.js"></script>
    <!-- User Activity Tracker -->
    <script src="../dist/js/user-tracker.js"></script>
  </body>
</html>
